## 1. 개요
위 키워드들의 공통점은 무엇일까요? 바로 성능 향상을 위해 도입할 수 있는 여러 가지 데이터 베이스 기법입니다.

## 2. 데이터 베이스의 기본 구조 
![[Pasted image 20240527152946.png]]

데이터 베이스의 기본 구조는 데이터 베이스 서버과 데이터 베이스 스토리지라고 볼 수 있습니다. 
서버는 SQL을 실행하고, 스토리지는 데이터를 보존합니다. 
## 3. [Clustering](https://hudi.blog/database-clustering/)
데이터 베이스 서버가 죽는 것을 대처하기 위해 데이터 베이스 서버를 여러 개로 만든 기법 
### 3-1. Active - Actice
여러 서버를 실제로 동작하는 상태로 주는 것입니다. 

시스템 전체가 정지하는 것을 방지할 수 있습니다. 또한 성능을 향상 시킬 수 있습니다. 

하지만 N개의 데이터 베이스 서버가 하나의 데이터베이스 스토리지를 공유하기 때문에 병목이 생길 수 있으며, 비용이 비쌉니다. 
### 3-2. Active - Standby
하나의 서버는 Active 상태로 가용하고 다른 하나의 서버는 Standby 상태로 대기하는 것을 의미합니다.

만약 Active 서버에 문제가 생긴다면 Standby 서버는 Active 서버로 전환됩니다. 

하지만 전환 하는 과정에서 시간이 오래 걸리기 때문에 즉각 오류에 대응할 수 없다는 단점이 있습니다.

## 4. [Replication ](https://hudi.blog/mysql-replication/)
> 저장된 데이터가 손실되는 것을 대처하기 위해 실제 데이터가 저장되는 데이터 베이스 스토리지 또한 복사하는 기법
### 4-1. 단순 백업  
기본적인 구성은 Master DB와 Slave DB로 나눠서 Master DB에 CRUD 가 발생할 경우 이를 그대로 동기화 해서 백업합니다.
### 4-2. 부하 분산 
Slave DB가 단순히 백업 용도로 쓰기에는 아까울 때는 부하를 분산합니다. CRUD에서 CUD는 Master DB에 R 작업은 Slave DB에서 수행될 수 있습니다.

## 5. Sharding
데이터가 너무 많아서 검색이 느려 더 바르게 검색 하기 위해 테이블을 나눠서 검색하는 기법 

샤딩은 테이블을 행 단위로 나눠서 각각의 Shard에 저장 하는 역할을 합니다. 따라서 데이터를 검색할 때 해당 데이터가 어느 Shard에 위치하는지 알아낸다면 빠르게 검색이 가능합니다. 

### 5-1. 고려사항
- 분산된 데이터베이스에 데이터를 어떻게 잘 분산시켜서 저장할것인가?
- 분산된 데이터베이스에서 데이터를 어떻게 읽을 것인가?
### 5-2. Shard Key
- 나눠진 Shard 중 어떤 Shard를 선택할지 결정하는 키
- Shard Key 결정 방식에 따라 Sharding 방법이 나뉨 

**Hash Sharding**
Shard Key를 결정할 때 Hash 함수를 사용하는 것입니다. 

구현 자체가 간단하지만 Shard가 들어나면 Hash 함수가 바뀌게 되고 기존에 저장되었던 데이터들에 대한 일관성이 깨지게 되어 확장성이 좋지 않습니다. 

또한, 단순히 Key를 기준으로 나누기 때문에 공간에 대한 효율성은 고려하지 않습니다. 

**Dynamic Sharding**
Locator Service라는 테이블 형식의 구성요소를 가지고 Shard Key를 결정합니다. 

따라서 Shard가 늘어난다고 하더라도 Locator Service 테이블을 변경하여 해결할 수 있습니다.

단점은 모든 Shard가 Locator Service에 의존하기 때문에 Locator Service에 문제가 생긴다면 Shard에 문제가 생깁니다. 

**Entity Group**
관계형 데이터 베이스 보다는 NoSQL 데이터 베이스에 더 잘 맞는 방식입니다. Entity Group은 관계가 있는 엔티티 끼리 같은 Shard 내에 공유하도록 하는 방식입니다. 

단일 Shard 내에서 쿼리가 효율적인 대신 다른 Shard와 연관된 경우 실행 효율이 오히려 떨어질 수 있습니다. 

> 데이터 베이스를 나누는 것도 다 비용 이기 때문에 현재 상황에 맞는 기술을 활용하는 것이 중요합니다. 

