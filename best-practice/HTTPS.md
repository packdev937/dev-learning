HTTPSë¥¼ ì ìš©í•˜ëŠ” ë‹¤ì–‘í•œ ë°©ë²•ì´ ìˆì§€ë§Œ ì˜¤ëŠ˜ í¬ìŠ¤íŒ…ì—ì…”ëŠ” docker-compose, nginx, certbotì„ ì‚¬ìš©í•´ì„œ HTTPSë¥¼ ì ìš©í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ê·¸ ê³¼ì •ì—ì„œ ë‚˜ì˜¤ëŠ” ì—¬ëŸ¬ ìš©ì–´ë“¤ì„ ìƒì„¸íˆ í’€ì–´ë³¼ ì˜ˆì •ì…ë‹ˆë‹¤. 
### HTTPSë€
ì´í•´ê°€ ì˜ë˜ëŠ” ì˜ˆì‹œê°€ ìˆì–´ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤. 
> ê³µì¸ëœ ì¸ì¦ ê¸°ê´€(CA)ì—ê²Œ ë‚´ ì„œë²„ì˜ ì£¼ë¯¼ë“±ë¡ì¦(SSL ì¸ì¦ì„œ) ì„ ë°œê¸‰ ë°›ê³ , ë¸Œë¼ìš°ì €ì™€ í†µì‹ í•  ë•Œ ë§ˆë‹¤ ì£¼ë¯¼ë“±ë¡ì¦ì„ ì œì‹œí•˜ë©° ìì‹ ì´ ì¸ì¦ë¨ì„ ì•Œë¦¬ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.

í•µì‹¬ì€ (1) ì¸ì¦ ê¸°ê´€ìœ¼ë¡œ ë¶€í„° SSL ì¸ì¦ì„œë¥¼ ë°œê¸‰ ë°›ê³ , (2) ë¸Œë¼ìš°ì €ê°€ ë‚´ ì„œë²„ì— ì ‘ì†í•  ë•Œ ë§ˆë‹¤ ì¸ì¦ì„œë¥¼ ì œì‹œí•˜ì—¬ ì•ˆì „í•œ ì„œë²„ì„ì„ ì…ì¦í•˜ë©°, (3) ì¸ì¦ì„œì— ì íŒ ë‚´ ì„œë²„ì˜ **key** ë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ì•”í˜¸í™” í•˜ë©° ì£¼ê³  ë°›ëŠ” ê²ƒì…ë‹ˆë‹¤. 

##### ì™œ HTTPSê°€ í•„ìš”í•œê°€ìš”?
ë„¤ì´ë²„ì— ì ‘ì†í•œë‹¤ê³  ê°€ì •í•´ë³´ê² ìŠµë‹ˆë‹¤. 
ë„¤ì´ë²„ì— ë¡œê·¸ì¸ì„ í•˜ê¸° ìœ„í•´ì„œ ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤. ë§Œì•½ í•´ë‹¹ í…ìŠ¤íŠ¸ê°€ ê·¸ëŒ€ë¡œ ë„¤ì´ë²„ê°€ ì•„ë‹Œ ì•…ì˜ì ì¸ ì„œë²„ì— ë“¤ì–´ê°„ë‹¤ë©´ ì–´ë–»ê²Œ ë ê¹Œìš”? ê°œì¸ ì •ë³´ê°€ ìœ ì¶œë˜ê²Œ ë©ë‹ˆë‹¤. 
ë”°ë¼ì„œ (1) ìš°ë¦¬ëŠ” ë’¤ì£½ë°•ì£½ ì•”í˜¸í™”ê°€ ëœ í…ìŠ¤íŠ¸ë¥¼ ì„œë²„ë¡œ ì „ì†¡í•©ë‹ˆë‹¤. 
(2) ë˜í•œ, ì ‘ì†í•œ ì‚¬ì´íŠ¸ê°€ ì§„í’ˆì¸ì§€ ê°€í’ˆì¸ì§€ íŒë³„í•´ì£¼ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.

ì¦‰, ê¸°ê´€ìœ¼ë¡œë¶€í„° ê²€ì¦ëœ ì‚¬ì´íŠ¸ë§Œ HTTPSê°€ í—ˆìš©ë˜ê¸° ë•Œë¬¸ì— HTTPSë¥¼ ì‚¬ìš©í•œë‹¤ëŠ” ê²ƒì€ ì•ˆì „í•˜ë‹¤ëŠ” ë°˜ì¦ì´ê² ì£ !

##### ì•”í˜¸í™”ëœ í…ìŠ¤íŠ¸ë¥¼ ì–´ë–»ê²Œ ë³µí˜¸í™”í•˜ë‚˜ìš”?
ì—¬ê¸°ì„œëŠ” ë¹„ëŒ€ì¹­í‚¤ë¥¼ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤. ë„¤ì´ë²„ ì„œë²„ëŠ” ê°œì¸í‚¤ì™€ ê³µê°œí‚¤ë¥¼ ê°–ê³  ìˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ì˜¤ì§ ê³µê°œí‚¤ë§Œ ê³µê°œí•˜ì£ . ì‚¬ìš©ìëŠ” ë°ì´í„°ë¥¼ ê³µê°œí‚¤ë¡œ ì•”í˜¸í™” í•˜ì—¬ ë³´ëƒ…ë‹ˆë‹¤. ê·¸ë¦¬ê³  ì•”í˜¸í™”ëœ ë°ì´í„°ëŠ” ì˜¤ì§ ê°œì¸í‚¤ë¡œë§Œ ë³µí˜¸í™” ê°€ëŠ¥í•©ë‹ˆë‹¤. 

##### ì‚¬ìš©ìì™€ ì„œë²„ê°€ í†µì‹ í•˜ëŠ” ê³¼ì • 
1) í´ë¼ì´ì–¸íŠ¸ëŠ” ì–´ë–¤ ëœë¤ ë°ì´í„°ë¥¼ ìƒì„±í•´ì„œ ì„œë²„ë¡œ ë³´ëƒ…ë‹ˆë‹¤
2) í•´ë‹¹ ë°ì´í„°ë¥¼ ë°›ì€ ì„œë²„ëŠ” ìƒì„±í•œ ë¬´ì‘ìœ„ ë°ì´í„° ê°’ê³¼ ì¸ì¦ì„œë¥¼ í•¨ê»˜ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë³´ëƒ…ë‹ˆë‹¤
3) ì´ë¥¼ handshakeë¼ê³  í•©ë‹ˆë‹¤
4) í´ë¼ì´ì–¸íŠ¸ëŠ” í•´ë‹¹ ì¸ì¦ì„œê°€ ì§„ì§œì¸ì§€ ë¸Œë¼ìš°ì €ì— ë‚´ì¥ëœ CA ë“¤ì˜ ì •ë³´ë¡œ í™•ì¸í•©ë‹ˆë‹¤
5) CAì˜ ì¸ì¦ì„ ë°›ì€ ì¸ì¦ì„œë“¤ì€ í•´ë‹¹ CAì˜ ê°œì¸í‚¤ë¡œ ì•”í˜¸í™” ë¼ìˆìŠµë‹ˆë‹¤
6) ì¦‰, ë¸Œë¼ìš°ì €ì˜ ë‚´ì¥ëœ CAì˜ ê°œì¸ í‚¤ë¡œ ë³µí˜¸í™”ê°€ ê°€ëŠ¥í•œ ì¸ì¦ì„œë¼ë©´ ì•ˆì „í•œ ì„œë²„ë¼ëŠ” ê²ƒì„ ì…ì¦í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ 
7) ì„±ê³µì ìœ¼ë¡œ ë³µí˜¸í™” ëœ ì¸ì¦ì„œì—ëŠ” ì„œë²„ì˜ ê³µê°œí‚¤ê°€ ìˆìŠµë‹ˆë‹¤. 
8) í•˜ì§€ë§Œ ë¹„ëŒ€ì¹­ í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ í†µì‹ ì„ í•˜ëŠ” ê²ƒì´ ì•„ë‹™ë‹ˆë‹¤. ì„œë²„ì—ì„œ ê°œì¸ í‚¤ë¡œ ë³µí˜¸í™” í•˜ëŠ” ê²ƒì€ ë§ì€ ë¹„ìš©ì´ ë“¤ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤
9) í•´ë‹¹ ë¹„ëŒ€ì¹­ í‚¤ëŠ” í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ ê°„ ëŒ€ì¹­ í‚¤ë¥¼ ê³µìœ í•  ë•Œ ì‚¬ìš©ë©ë‹ˆë‹¤. ëŒ€ì¹­ í‚¤ê°€ ë¹„ë°€ë¡œ ìœ ì§€ê°€ ëœë‹¤ë©´ í•´ë‹¹ ëŒ€ì¹­ í‚¤ë¡œ í†µì‹ ì„ ì´ì–´ë‚˜ê°€ë„ ë³´ì•ˆì ìœ¼ë¡œ ì „í˜€ ë¬¸ì œê°€ ì—†ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. 

### ê°€ë¹„ì•„ì—ì„œ ë„ë©”ì¸ êµ¬ì… 
ë„ë©”ì¸ì„ EC2ì— ì ìš©í•˜ëŠ” ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. 
- EC2 ì— íƒ„ë ¥ì  IP (ê³ ì • IP) ì ìš©
- EC2ì˜ IPë¥¼ ë‚´ ë„ë©”ì¸ì˜ A íƒ€ì…ê³¼ ë§¤í•‘ 

ğŸ¤” ë„ë©”ì¸ì—ì„œ A, AAA, CNAME ë“±ì´ ë­˜ ì˜ë¯¸í• ê¹Œìš”?
ì„œë¸Œ ë„ë©”ì¸ì„ ë“±ë¡í•˜ê¸° ìœ„í•´ì„œëŠ” A, CNAME ê°™ì€ ë ˆì½”ë“œ ì •ë³´ë¥¼ ë“±ë¡í•´ì•¼ í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ë ˆì½”ë“œ ì •ë³´ê°€ ì™œ í•„ìš”í•˜ê³  ì–´ë–»ê²Œ ì‚¬ìš©ë ê¹Œìš”? 

#### [DNS](https://dev.plusblog.co.kr/30#google_vignette)
ì¸í„°ë„·ì„ êµ¬ì„±í•˜ê³  ìˆëŠ” IP ì£¼ì†ŒëŠ” 127.0.0.1 ê³¼ ê°™ì´ ìˆ«ìë¡œ êµ¬ì„±ë©ë‹ˆë‹¤. ì´ëŸ¬í•œ ìˆ«ìëŠ” ì‚¬ëŒì´ ì¼ì¼ì´ ì™¸ìš°ê¸° í˜ë“¤ê¸° ë•Œë¬¸ì— ë¬¸ìì—´ë¡œ IP ì£¼ì†Œë¥¼ í‘œí˜„í•˜ê¸° ì‹œì‘í•˜ì˜€ìŠµë‹ˆë‹¤. ë‹¤ë§Œ ì‹¤ì œ í†µì‹ ì—ì„œëŠ” www.naver.com ì„ ì ‘ì†í•˜ë©´ IPv4 ì£¼ì†Œë¡œ ë³€í™˜í•´ ì£¼ëŠ” ì‘ì—…ì´ í•„ìš”í•©ë‹ˆë‹¤. ì´ëŸ° ì„œë¹„ìŠ¤ë¥¼ DNS ì„œë¹„ìŠ¤ ë¼ê³  í•©ë‹ˆë‹¤. 

DNS ì„œë²„ëŠ” ë„ë©”ì¸ ì£¼ì†Œì™€ IP ì£¼ì†Œê°€ ìŒìœ¼ë¡œ í…Œì´ë¸”ì— ì €ì¥ë˜ì–´ ìˆìŠµë‹ˆë‹¤. 
ë ˆì½”ë“œëŠ” í•´ë‹¹ í…Œì´ë¸”ì—ì„œ í•˜ë‚˜ì˜ í–‰ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. 

**A ë ˆì½”ë“œ**ëŠ” DNSì— ì €ì¥ë˜ëŠ” ì •ë³´ì˜ íƒ€ì…ìœ¼ë¡œ ë„ë©”ì¸ ì£¼ì†Œì™€Â ì„œë²„ì˜ IP ì£¼ì†Œê°€ ì§ì ‘ ë§¤í•‘ì‹œí‚¤ëŠ” ë°©ë²•ì…ë‹ˆë‹¤. í…Œì´ë¸”ì—ì„œ naver.com ê°™ì€ ê²ƒì´ ë„ë©”ì¸ ì£¼ì†Œ, 192.168.0.1 ê°™ì´ ìˆ«ìë¡œ ì´ë£¨ì–´ì§„ ì£¼ì†Œê°€ IP ì£¼ì†Œì…ë‹ˆë‹¤.

**CNAME ë ˆì½”ë“œ**ëŠ” Canonical Nameì˜ ì•½ìë¡œ ë„ë©”ì¸ ì£¼ì†Œë¥¼ ë˜ ë‹¤ë¥¸ ë„ë©”ì¸ ì£¼ì†Œë¡œ ë§¤í•‘í•˜ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. 
ì˜ˆë¥¼ ë“¤ì–´, dev.naver.com | www.naver.com ì´ ìˆê³  www.naver.com | 192.168.0.1 ì´ ìˆë‹¤ê³  ê°€ì •í•´ë´…ì‹œë‹¤. dev.naver.com ìœ¼ë¡œ ì ‘ì†í–ˆë‹¤ë©´ DNS ì„œë²„ëŠ” www.naver.comì„ ë°˜í™˜í•˜ê³  ë‹¤ì‹œ www.naver.comì„ DNS ì„œë²„ì— ìš”ì²­í•´ IP ì£¼ì†Œë¥¼ ì–»ì–´ë‚´ê²Œ ë©ë‹ˆë‹¤. 

A ë ˆì½”ë“œì™€ CNAME ë ˆì½”ë“œì˜ ì¥ë‹¨ì ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

A ë ˆì½”ë“œì˜ ì¥ì ì€ í•œ ë²ˆì˜ ìš”ì²­ìœ¼ë¡œ ì°¾ì•„ê°ˆ ì„œë²„ì˜ IP ì£¼ì†Œì— ë°”ë¡œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë‹¤ëŠ” ì ì…ë‹ˆë‹¤. ë‹¨ì ì€ ì—¬ëŸ¬ ë„ë©”ì¸ ì£¼ì†Œê°€ í•˜ë‚˜ì˜ IP ì£¼ì†Œë¥¼ ì°¸ì¡°í•˜ê³  ìˆì„ ë•Œ, í•´ë‹¹ ì£¼ì†Œê°€ ë°”ë€ë‹¤ë©´ ëª¨ë“  A ë ˆì½”ë“œë¥¼ ë³€ê²½í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.

CNAME ë ˆì½”ë“œëŠ” ì—¬ëŸ¬ ë²ˆì˜ ìš”ì²­ì´ í•„ìš”í•˜ì§€ë§Œ ë°˜ëŒ€ë¡œ ì£¼ì†Œê°€ ë°”ë€ë‹¤ë©´ ì°¸ì¡°í•˜ê³  ìˆëŠ” ë„ë©”ì¸ ì£¼ì†Œì˜ IP ì£¼ì†Œë§Œ ë³€ê²½í•´ì£¼ë©´ ë©ë‹ˆë‹¤. 

### [Nginx ì„¤ì •](https://dkswnkk.tistory.com/675)
EC2ì— ì§ì ‘ ì„¤ì •í•  ìˆ˜ë„ ìˆê³  ë„ì»¤ë¡œ Nginx ì»¨í…Œì´ë„ˆë¥¼ ì„¤ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìš°ì„  í†µìƒì ì¸ Nginx ì„¤ì • ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ê³ ì í•©ë‹ˆë‹¤. 

Nginxì˜ ì„¤ì • íŒŒì¼ì„ ìˆ˜ì •í•´ì£¼ì–´ì•¼ í•˜ëŠ”ë° ëŒ€ê²Œ ì„¤ì • íŒŒì¼ì€ /etc/nginx ë°‘ì— ìœ„ì¹˜í•˜ê³  ìˆìŠµë‹ˆë‹¤. 

ë§Œì•½ ì„¤ì • íŒŒì¼ì„ ëª» ì°¾ê² ë‹¤ë©´ ë‹¤ìŒì„ ì„¤ì •í•´ì£¼ë©´ ë©ë‹ˆë‹¤. 
```bash
find / -name nginx.conf
```

### dockerë€? 
ë„ì»¤(Docker)ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì»¨í…Œì´ë„ˆ(Container)ë¼ëŠ” ê²©ë¦¬ëœ í™˜ê²½ì—ì„œ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ” ì˜¤í”ˆ ì†ŒìŠ¤ í”Œë«í¼ì…ë‹ˆë‹¤. ì»¨í…Œì´ë„ˆëŠ” ê°€ë³ê³  íœ´ëŒ€ê°€ëŠ¥í•˜ë©°, ìš´ì˜ì²´ì œ ìˆ˜ì¤€ì—ì„œ ê²©ë¦¬ë˜ì–´, ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹¤í–‰ë˜ëŠ” í™˜ê²½ì„ ì½”ë“œì™€ í•¨ê»˜ íŒ¨í‚¤ì§•í•˜ì—¬ ì–´ëŠ í™˜ê²½ì—ì„œë‚˜ ë™ì¼í•˜ê²Œ ì‘ë™í•˜ë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤.
##### ë„ì»¤ì˜ ì£¼ìš” ê°œë…

- **ì´ë¯¸ì§€(Image)**: ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ê·¸ ì‹¤í–‰ì— í•„ìš”í•œ ëª¨ë“  íŒŒì¼, ë¼ì´ë¸ŒëŸ¬ë¦¬, ì˜ì¡´ì„±ì„ í¬í•¨í•˜ëŠ” ê²½ëŸ‰ì˜, ì‹¤í–‰ ê°€ëŠ¥í•œ ì†Œí”„íŠ¸ì›¨ì–´ íŒ¨í‚¤ì§€ì…ë‹ˆë‹¤. ì´ë¯¸ì§€ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹¤í–‰ë˜ê¸° ì „ì˜ ìƒíƒœë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
- **ì»¨í…Œì´ë„ˆ(Container)**: ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‹¤í–‰ëœ ì¸ìŠ¤í„´ìŠ¤ì…ë‹ˆë‹¤. ì»¨í…Œì´ë„ˆëŠ” ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ì‹¤í–‰í•  ë•Œ ìƒì„±ë˜ë©°, ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹¤ì œë¡œ ì‘ë™í•˜ëŠ” ê²©ë¦¬ëœ í™˜ê²½ì…ë‹ˆë‹¤.
- **ë„ì»¤ íŒŒì¼(Dockerfile)**: ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•œ ëª…ë ¹ì–´ì™€ ì„¤ì •ì´ í¬í•¨ëœ í…ìŠ¤íŠ¸ íŒŒì¼ì…ë‹ˆë‹¤. ì´ íŒŒì¼ì€ ì´ë¯¸ì§€ ë¹Œë“œ ê³¼ì •ì„ ìë™í™”í•©ë‹ˆë‹¤.
##### ë„ì»¤ì˜ ì¥ì 
- **í™˜ê²½ ì¼ê´€ì„±**: ê°œë°œ, í…ŒìŠ¤íŠ¸, í”„ë¡œë•ì…˜ í™˜ê²½ ê°„ì˜ ì°¨ì´ë¥¼ ìµœì†Œí™”í•˜ì—¬, ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ë” ë¹ ë¥´ê³  ì•ˆì •ì ìœ¼ë¡œ ë°°í¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **íœ´ëŒ€ì„±**: ì–´ë–¤ í™˜ê²½ì—ì„œë„ ë™ì¼í•˜ê²Œ ì‘ë™í•˜ëŠ” ì»¨í…Œì´ë„ˆë¥¼ ìƒì„±í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‰½ê²Œ ì´ì „, ë°°í¬ ë° í™•ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **ê°€ë³ê³  ë¹ ë¦„**: ê°€ìƒë¨¸ì‹ ì— ë¹„í•´ ì»¨í…Œì´ë„ˆëŠ” ë” ê°€ë³ê³  ë¹ ë¥´ë©°, ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ì´ íš¨ìœ¨ì ì…ë‹ˆë‹¤. ì´ëŠ” ì»¨í…Œì´ë„ˆê°€ ê²ŒìŠ¤íŠ¸ ìš´ì˜ì²´ì œë¥¼ í•„ìš”ë¡œ í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
- **ê²©ë¦¬ì„±**: ê° ì»¨í…Œì´ë„ˆëŠ” ì„œë¡œ ë…ë¦½ì ìœ¼ë¡œ ì‹¤í–‰ë˜ë¯€ë¡œ, í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë³€ê²½ì´ë‚˜ ì˜¤ë¥˜ê°€ ë‹¤ë¥¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠìŠµë‹ˆë‹¤.
- **ìë™í™”**: ë„ì»¤ì˜ ìë™í™” ë„êµ¬ëŠ” ê°œë°œ ë° ë°°í¬ ê³¼ì •ì„ ê°„ì†Œí™”í•˜ê³ , CI/CD(ì§€ì†ì  í†µí•©/ì§€ì†ì  ë°°í¬) íŒŒì´í”„ë¼ì¸ê³¼ì˜ í†µí•©ì„ ìš©ì´í•˜ê²Œ í•©ë‹ˆë‹¤.
##### EC2ì— docker ì„¤ì¹˜ 
[[AWS EC2 ì¸ìŠ¤í„´ìŠ¤ì— Docker ì„¤ì¹˜í•˜ê¸°]]

### docker-compose ì„¸íŒ… 
ìš°ì„  nginx, certbot ëª¨ë‘ Docker Libraryì—ì„œ ì§€ì›í•©ë‹ˆë‹¤. 

`docker-compose.yml`ë¥¼ ì‘ì„±í•˜ê¸° ì „ ì¡°ê¸ˆ ë” ìì„¸íˆ ì•Œì•„ë´…ì‹œë‹¤. 
- ì„œë¹„ìŠ¤ ì´ë¦„ 
	services: 
		server:
	ìœ„ì™€ ê°™ì´ ì„¤ì • íŒŒì¼ì´ êµ¬ì„±ë˜ì–´ ìˆì„ ë•Œ ì—ì„œ serverê°€ ì„œë¹„ìŠ¤ ì´ë¦„ì…ë‹ˆë‹¤. 
	ì„œë¹„ìŠ¤ ì´ë¦„ì€ ë„¤íŠ¸ì›Œí¬ ì„¤ì •ì´ë‚˜ Docker Composeì˜ ë‹¤ë¥¸ ë¶€ë¶„ì—ì„œ ì„œë¹„ìŠ¤ë¥¼ ì°¸ì¡°í•  ë•Œ ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
	
	ì„œë¹„ìŠ¤ì˜ ì´ë¦„ì€ ìœ ì¼ (unique) í•´ì•¼ë˜ë©° ëª…í™•í•˜ê³  ê¸°ì–µí•˜ê¸° ì‰¬ì›Œì•¼ í•©ë‹ˆë‹¤. 
- imageëŠ” ì„œë¹„ìŠ¤ì—ì„œ ì‚¬ìš©í•  ì»¨í…Œì´ë„ˆì˜ ì´ë¯¸ì§€ë¥¼ ì§€ì •í•©ë‹ˆë‹¤. 
	ì´ë¯¸ì§€ì˜ ì´ë¦„ì€ "ì´ë¯¸ì§€ ì´ë¦„ : íƒœê·¸" í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•©ë‹ˆë‹¤.
	image : nginx:1.19.0-alpine
	ì´ë¯¸ì§€ëŠ” í¬ê²Œ ê³µì‹ ì´ë¯¸ì§€ì™€ ì‚¬ìš©ì ì •ì˜ ì´ë¯¸ì§€ë¡œ ë‚˜ë‰  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
	
	ê³µì‹ ì´ë¯¸ì§€ëŠ” íŠ¹ë³„í•œ ì´ë¦„ ê³µê°„ì—ì„œ ê´€ë¦¬ ë©ë‹ˆë‹¤. `eg) 'nginx'`
	
	ì‚¬ìš©ì ìƒì„± ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
	í˜•ì‹ì€ `[username]/[image ì´ë¦„] : [tag]` ì…ë‹ˆë‹¤.
- ports
	"í˜¸ìŠ¤íŠ¸ í¬íŠ¸ : ì»¨í…Œì´ë„ˆ í¬íŠ¸" ë¡œ ì‘ì„±ë©ë‹ˆë‹¤.
	ports:
		- "5000:5000"
	í˜¸ìŠ¤íŠ¸ì˜ 5000 í¬íŠ¸ë¥¼ ì»¨í…Œì´ë„ˆì˜ 5000 í¬íŠ¸ì— ì—°ê²°í•œë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤. 
	
	í˜¸ìŠ¤íŠ¸ì˜ í¬íŠ¸ì™€ ì»¨í…Œì´ë„ˆ í¬íŠ¸ëŠ” ì–´ë–¤ ì°¨ì´ê°€ ìˆì„ê¹Œìš”?
	í˜¸ìŠ¤íŠ¸ í¬íŠ¸ë¥¼ í†µí•´ì„œ ì™¸ë¶€ ë„¤íŠ¸ì›Œí¬ì—ì„œ í˜¸ìŠ¤íŠ¸ ì‹œìŠ¤í…œì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í˜¸ìŠ¤íŠ¸ í¬íŠ¸ë¥¼ í†µí•´ ë“¤ì–´ì˜¨ íŠ¸ë˜í”½ì€ ì§€ì •ëœ ì»¨í…Œì´ë„ˆ í¬íŠ¸ë¡œ ì „ë‹¬ë©ë‹ˆë‹¤. 
	
	ì»¨í…Œì´ë„ˆ í¬íŠ¸ëŠ” ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì˜ ë„¤íŠ¸ì›Œí¬ í¬íŠ¸ì…ë‹ˆë‹¤. ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ í•´ë‹¹ í¬íŠ¸ë¥¼ í†µí•´ ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ì„ ìˆ˜ì‹ í•©ë‹ˆë‹¤. 
	
	ì´ë¥¼ í†µí•´ ì—¬ëŸ¬ ì»¨í…Œì´ë„ˆê°€ ê°™ì€ í¬íŠ¸ë¥¼ ì‚¬ìš©í•˜ê³  ìˆì„ ë•Œ ê° ì»¨í…Œì´ë„ˆë¥¼ ë‹¤ë¥¸ í˜¸ìŠ¤íŠ¸ í¬íŠ¸ì— ë§¤í•‘í•¨ìœ¼ë¡œì¨ í¬íŠ¸ ì¶©ëŒì„ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
	
	ì˜ˆë¥¼ ë“¤ì–´, ìŠ¤í”„ë§ ë¶€íŠ¸ì—ì„œ í¬íŠ¸ ë²ˆí˜¸ë¥¼ 8081ë¡œ ì„¤ì •í•˜ê³  í˜¸ìŠ¤íŠ¸ í¬íŠ¸ëŠ” 8080ìœ¼ë¡œ ì„¤ì •í–ˆë‹¤ë©´ í˜¸ìŠ¤íŠ¸ ì‹œìŠ¤í…œì˜ 8080 í¬íŠ¸ë¡œ ë³´ë‚´ì§„ ìš”ì²­ì´ 8081ë¡œ ì „ë‹¬ë©ë‹ˆë‹¤. 
- container_name
	ì»¨í…Œì´ë„ˆë¥¼ 

ë³¼ë¥¨ ë§ˆìš´íŠ¸ë¥¼ ì„¤ì •í•˜ëŠ”ë¶€ë¶„ì…ë‹ˆë‹¤.

- volumes : í˜¸ìŠ¤íŠ¸ì™€ ì»¨í…Œì´ë„ˆ ì‚¬ì´ì˜ ë³¼ë¥¨ì„ ì„¤ì •í•©ë‹ˆë‹¤. ë³¼ë¥¨ì€ ë°ì´í„°ë¥¼ ì»¨í…Œì´ë„ˆê°€ ì•„ë‹Œ í˜¸ìŠ¤íŠ¸ ì‹œìŠ¤í…œì— ì €ì¥í•˜ê²Œ í•´ì„œ ì»¨í…Œì´ë„ˆê°€ ì‚­ì œë˜ê±°ë‚˜ ì¬ì‹œì‘ë  ë•Œë„ ë°ì´í„°ë¥¼ ìœ ì§€í•˜ë„ë¡ í•˜ëŠ” ì„¤ì •ì…ë‹ˆë‹¤. 

	ì˜ˆë¥¼ ë“¤ì–´, `./data/nginx:/etc/nginx/conf.d` ë‹¤ìŒê³¼ ê°™ì€ ì„¤ì •ì„ í–ˆë‹¤ê³  ê°€ì •í•´ë´…ì‹œë‹¤. ì´ëŠ” /data/nginx ë””ë ‰í† ë¦¬ì™€ Nginx ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì˜ /etc/nginx/conf.d ë¥¼ ì—°ê²°í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.
	

```yaml
version: '3'
services:  
  server:
    container_name : server
    image : goodmoneying/server
    ports :
      - 8080:8080
    restart: "always"

  nginx:  
    image: nginx:1.15-alpine  
    ports:  
      - 80:80
      - 443:443 
    volumes:  
      - ./data/nginx:/etc/nginx/conf.d 
      - ./data/certbot/conf:/etc/letsencrypt  
	  - ./data/certbot/www:/var/www/certbot
	depends_on :
	  - "server"

  certbot:  
    image: certbot/certbot
    volumes:  
	  - ./data/certbot/conf:/etc/letsencrypt  
	  - ./data/certbot/www:/var/www/certbot
```

ì—¬ê¸°ì„œ example.orgëŠ” ìš°ë¦¬ì˜ ë„ë©”ì¸ìœ¼ë¡œ ë°”ê¿”ì¤˜ì•¼ í•©ë‹ˆë‹¤. 
- ì°¸ê³ ë¡œ í•´ë‹¹ íŒŒì¼ì˜ ê²½ë¡œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. (`data/nginx/app.conf`)
```
server {  
    listen 80;  
    listen [::]:80;
    server_name example.org;    
    
    location / {  
        return 301 https://$host$request_uri;
    }

	location /.well-known/acme-challenge/ {  
		root /var/www/certbot;  
	}	  
}

server {  
    listen 443 ssl;  
    server_name example.org;  

	ssl_certificate /etc/letsencrypt/live/packdev937.site/fullchain.pem;  
	ssl_certificate_key /etc/letsencrypt/live/packdev937.site/privkey.pem;
	include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; 

	location / {
        proxy_pass  http://server:8080;
        proxy_set_header    Host                $http_host;
        proxy_set_header    X-Real-IP           $remote_addr;
        proxy_set_header    X-Forwarded-For     $proxy_add_x_forwarded_for;
    } 
}
```

init-letsencrypt.sh ë„ í™ˆ ë””ë ‰í† ë¦¬ ê²½ë¡œì— ë„£ì–´ì¤ë‹ˆë‹¤. 
```
curl -L "https://raw.githubusercontent.com/wmnnd/nginx-certbot/master/init-letsencrypt.sh" > init-letsencrypt.sh

chmod +x init-letsencrypt.sh
```

```
#!/bin/bash

if ! [ -x "$(command -v docker-compose)" ]; then
  echo 'Error: docker-compose is not installed.' >&2
  exit 1
fi

domains=(goodmoneying.shop)
rsa_key_size=4096
data_path="./data/certbot"
email="good.moneying.2024@gmail.com" # Adding a valid address is strongly recommended
staging=0 # Set to 1 if you're testing your setup to avoid hitting request limits

if [ -d "$data_path" ]; then
  read -p "Existing data found for $domains. Continue and replace existing certificate? (y/N) " decision
  if [ "$decision" != "Y" ] && [ "$decision" != "y" ]; then
    exit
  fi
fi


if [ ! -e "$data_path/conf/options-ssl-nginx.conf" ] || [ ! -e "$data_path/conf/ssl-dhparams.pem" ]; then
  echo "### Downloading recommended TLS parameters ..."
  mkdir -p "$data_path/conf"
  curl -s https://raw.githubusercontent.com/certbot/certbot/master/certbot-nginx/certbot_nginx/_internal/tls_configs/options-ssl-nginx.conf > "$data_path/conf/options-ssl-nginx.conf"
  curl -s https://raw.githubusercontent.com/certbot/certbot/master/certbot/certbot/ssl-dhparams.pem > "$data_path/conf/ssl-dhparams.pem"
  echo
fi

echo "### Creating dummy certificate for $domains ..."
path="/etc/letsencrypt/live/$domains"
mkdir -p "$data_path/conf/live/$domains"
docker-compose run --rm --entrypoint "\
  openssl req -x509 -nodes -newkey rsa:$rsa_key_size -days 1\
    -keyout '$path/privkey.pem' \
    -out '$path/fullchain.pem' \
    -subj '/CN=localhost'" certbot
echo


echo "### Starting nginx ..."
docker-compose up --force-recreate -d nginx
echo

echo "### Deleting dummy certificate for $domains ..."
docker-compose run --rm --entrypoint "\
  rm -Rf /etc/letsencrypt/live/$domains && \
  rm -Rf /etc/letsencrypt/archive/$domains && \
  rm -Rf /etc/letsencrypt/renewal/$domains.conf" certbot
echo


echo "### Requesting Let's Encrypt certificate for $domains ..."
#Join $domains to -d args
domain_args=""
for domain in "${domains[@]}"; do
  domain_args="$domain_args -d $domain"
done

# Select appropriate email arg
case "$email" in
  "") email_arg="--register-unsafely-without-email" ;;
  *) email_arg="--email $email" ;;
esac

# Enable staging mode if needed
if [ $staging != "0" ]; then staging_arg="--staging"; fi

docker-compose run --rm --entrypoint "\
  certbot certonly --webroot -w /var/www/certbot \
    $staging_arg \
    $email_arg \
    $domain_args \
    --rsa-key-size $rsa_key_size \
    --agree-tos \
    --force-renewal" certbot
echo

echo "### Reloading nginx ..."
docker-compose exec nginx nginx -s reload
```

ì‹¤í–‰ì€ ë‹¤ìŒê³¼ ê°™ì´ ì§„í–‰í•©ë‹ˆë‹¤.
```
sudo ./init-letsencrypt.sh
docker-compose up
```

### ë¬¸ì œ ë°œìƒ 
- ë¦¬ë‹¤ì´ë ‰ì…˜ ìš”ì²­ì´ ë„ˆë¬´ ë§ìŠµë‹ˆë‹¤. 
	data/nginx/app.conf ì— proxy_passê°€ ë™ì¼í•œ ë„ë©”ì¸ìœ¼ë¡œ ë˜ì–´ ìˆì§€ëŠ” ì•Šì€ì§€ í™•ì¸í•˜ì„¸ìš”.
	ì´ ë•Œ http://[ì»¨í…Œì´ë„ˆ_ì´ë¦„]:8080 ìœ¼ë¡œ ì§„í–‰í•´ì•¼ í•©ë‹ˆë‹¤. 
- 
### Reference 
[1](https://velog.io/@lamazzang25/Docker-compose-certbot-nginx-%EB%A1%9C-ssl-%EC%9D%B8%EC%A6%9D%EC%84%9C-%EB%B0%9C%EA%B8%89%ED%95%98%EA%B8%B0)
[2](https://pentacent.medium.com/nginx-and-lets-encrypt-with-docker-in-less-than-5-minutes-b4b8a60d3a71)
[3](https://velog.io/@crab4862/AWS-%ED%95%98%EB%82%98%EC%9D%98-%EB%8F%84%EB%A9%94%EC%9D%B8%EC%9C%BC%EB%A1%9C-%EB%91%90-%EA%B0%9C%EC%9D%98-%EC%9B%B9%EC%82%AC%EC%9D%B4%ED%8A%B8-%ED%98%B8%EC%8A%A4%ED%8C%85%ED%95%98%EA%B8%B0-SubDomain)

